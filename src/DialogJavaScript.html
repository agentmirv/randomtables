<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/1.0.11/jsviews.min.js" integrity="sha512-nzeptB37xiXMYfCfY/IF7iDG13S82taErKCx2+bIWukARqZNu7Gea6W7/VYf5FerrcIpfB5RkrjR9hEyvLtO9A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://www.jsviews.com/download/sample-tag-controls/jsviews-jqueryui-widgets.min.js"></script>
<script>
$.views.viewModels({
  Dialog: {
    getters: [
    "url",
    "outputRange",
    "inputCount",
    "inputRange",
    "statusMessage",
    "isError",
    "isDisabled",
     { getter: "inputs", type: "Input" },
    ],
  },
  Input: {
    getters: [
      "description",
      "hasOptions",
      "index",
      "isLoaded",
      "value",
      { getter: "options", type: "Option" },
    ]
  },
  Option: {
    getters: [
      "value",
    ]
  },
});  
</script>
<script>
  var dialog = $.views.viewModels.Dialog.map(data);
  </script>  
<script>
  var helpers = {
    //=================================
    // handleInitialize -> for handleLoadDialogInput
    //=================================
    handleInitialize: function(dialogData) {
      var url = dialogData.url();
      var inputCount = dialogData.inputCount();
      var inputRange = dialogData.inputRange();
      for (var i = 0; i < inputCount; i++) {
        $.observable(dialogData.inputs()).insert($.views.viewModels.Input.map({ options:[] }));
        google.script.run
          .withUserObject(dialogData)
          .withSuccessHandler(
            function (input, userObject) {
              userObject.inputs()[input.index].merge(input);
            })
          .withFailureHandler(
            function (msg, userObject) {
              userObject.statusMessage(msg);
              userObject.isError(true);
            })
          .handleLoadDialogInput(url, inputRange, i);
      }
    },
    //=================================
    // handleSubmitDialog -> handleSubmitDialog
    //=================================
    handleSubmitDialog: function(ev, eventArgs) {
      var dialogData = eventArgs.view.data;
      var dialogSubmitData = dialogData.unmap();
      dialogData.isDisabled(true);
      google.script.run
        .withUserObject(dialogData)
        .withSuccessHandler(
          function (userObject) {
            google.script.host.close();
          })  
        .withFailureHandler(
          function (msg, userObject) {
            userObject.statusMessage(msg);
            userObject.isError(true);
          })
        .handleSubmitDialog(dialogSubmitData);
    },
  };
   
  $.templates("dialogTemplate", "#dialog-form-template");
  $.link.dialogTemplate("#dialog-form", dialog, helpers);

  helpers.handleInitialize(dialog);
</script>
